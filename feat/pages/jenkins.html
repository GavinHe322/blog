<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>笔记</title>
    <meta name="description" content="">
    <link rel="icon" href="/blog/logo.ico">
    <meta name="referrer" content="never">
    <link rel="preload" href="/blog/assets/css/0.styles.dc50d109.css" as="style"><link rel="preload" href="/blog/assets/js/app.7e52a773.js" as="script"><link rel="preload" href="/blog/assets/js/2.49ba155e.js" as="script"><link rel="preload" href="/blog/assets/js/10.6f95f390.js" as="script"><link rel="prefetch" href="/blog/assets/js/11.923cbd96.js"><link rel="prefetch" href="/blog/assets/js/12.dd434dc0.js"><link rel="prefetch" href="/blog/assets/js/13.eb9f3a91.js"><link rel="prefetch" href="/blog/assets/js/14.66ca09d1.js"><link rel="prefetch" href="/blog/assets/js/15.11a1fd0a.js"><link rel="prefetch" href="/blog/assets/js/16.89fe4eea.js"><link rel="prefetch" href="/blog/assets/js/17.4aa9182e.js"><link rel="prefetch" href="/blog/assets/js/18.4a26d176.js"><link rel="prefetch" href="/blog/assets/js/3.6b0d47ed.js"><link rel="prefetch" href="/blog/assets/js/4.fadcb688.js"><link rel="prefetch" href="/blog/assets/js/5.146a072b.js"><link rel="prefetch" href="/blog/assets/js/6.537327aa.js"><link rel="prefetch" href="/blog/assets/js/7.58746721.js"><link rel="prefetch" href="/blog/assets/js/8.b769c333.js"><link rel="prefetch" href="/blog/assets/js/9.81a795d5.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.dc50d109.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/home/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/problem/" class="nav-link">问题</a></div><div class="nav-item"><a href="/blog/feat/" class="nav-link router-link-active">技术沉淀</a></div><div class="nav-item"><a href="https://github.com/GavinHe322" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/home/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/problem/" class="nav-link">问题</a></div><div class="nav-item"><a href="/blog/feat/" class="nav-link router-link-active">技术沉淀</a></div><div class="nav-item"><a href="https://github.com/GavinHe322" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>环境搭建</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/feat/pages/jenkins.html" class="active sidebar-link">jenkins</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/feat/pages/jenkins.html#jenkins" class="sidebar-link">Jenkins</a></li><li class="sidebar-sub-header"><a href="/blog/feat/pages/jenkins.html#目录" class="sidebar-link">目录</a></li></ul></li><li><a href="/blog/feat/pages/node.html" class="sidebar-link">node</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>实战</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><h2 id="jenkins"><a href="#jenkins" class="header-anchor">#</a> Jenkins</h2></blockquote> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> <strong>概念</strong></h3> <ul><li>Jenkins是一款开源 CI&amp;CD 软件，用于自动化各种任务，包括构建、测试和部署软件。</li> <li>Jenkins 支持各种运行方式，可通过系统包、Docker 或者通过一个独立的 Java 程序。</li></ul> <h3 id="为什么要学"><a href="#为什么要学" class="header-anchor">#</a> <strong>为什么要学</strong></h3> <ul><li>公司在用</li> <li>稍微好一点的岗位职责像<code>jenkins</code>之类 (持续集成、自动部署) 的，基本都是多多少少是会提到的。</li> <li>传统的做法，在服务器初始一个 <code>git</code> 仓库，然后每次代码更新后，人工手动去拉去，次数多了也就烦了，而这些每次只需在项目开始前配置一遍 <code>jenkins</code> 之后所有的人工操作都不需要管了。(ps: 有问题甩锅给 <code>jenkins</code> 就行了[呲牙])</li></ul> <h3 id="前置任务"><a href="#前置任务" class="header-anchor">#</a> <strong>前置任务</strong></h3> <ul><li><code>centOs</code> 服务器</li> <li><code>git</code>、 <code>linux</code>、<code>shell</code> 基础就行。</li> <li><code>nginx</code>基本配置。</li></ul> <h3 id="开篇准备"><a href="#开篇准备" class="header-anchor">#</a> <strong>开篇准备</strong></h3> <p><strong>初始一个 <code>vuecli</code> 项目，访问如下</strong></p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e97572df9eaafb?w=3318&amp;h=1108&amp;f=png&amp;s=156601" alt=""> <strong>在 <code>github</code> 创建仓库</strong></p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e975c831902e62?w=2488&amp;h=1560&amp;f=png&amp;s=447256" alt=""></p> <p><strong>配置 <code>github webhook</code></strong></p> <p><code>http://ip:8080/github-webhook/</code></p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e97f623c208cc2?w=2264&amp;h=1600&amp;f=png&amp;s=353667" alt=""></p> <blockquote><h2 id="目录"><a href="#目录" class="header-anchor">#</a> <strong>目录</strong></h2></blockquote> <ul><li><a href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">jenkins 环境搭建</a></li> <li><a href="#%E6%96%B0%E5%BB%BA%E4%BB%BB%E5%8A%A1">新建 jenkins 任务</a></li> <li><a href="#nginx">nginx访问</a></li></ul> <h3 id="环境搭建"><a href="#环境搭建" class="header-anchor">#</a> 环境搭建</h3> <p>登录服务器</p> <p><strong>安装<code>java</code>依赖</strong></p> <div class="language- extra-class"><pre class="language-text"><code>yum install java
</code></pre></div><p><strong>使用 <code>wget</code> 添加<code>jenkins源</code></strong></p> <div class="language- extra-class"><pre class="language-text"><code>wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins-ci.org/redhat/jenkins.repo
rpm --import https://jenkins-ci.org/redhat/jenkins-ci.org.key
</code></pre></div><p><strong>安装之后使用 <code>yum</code> 命令就能下载了。</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>yum install jenkins
</code></pre></div><p><strong>jenkins 修改权限 端口之类的，在该位置</strong></p> <div class="language- extra-class"><pre class="language-text"><code>vim /etc/sysconfig/jenkins
</code></pre></div><ul><li>JENKINS_PORT -&gt; jenkins的<strong>启动端口</strong>，默认<code>8080</code></li> <li>JENKINS_USER -&gt; jenkins 用户，修改为<code>root</code></li></ul> <div class="language- extra-class"><pre class="language-text"><code>// 这里我将 JENKINS_USER 修改为 root 用户了。
JENKINS_USER=&quot;root&quot;
</code></pre></div><p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e977fff4cdd93a?w=932&amp;h=262&amp;f=png&amp;s=128287" alt=""></p> <p><strong>使用 <code>chown</code>给 <code>jenkins</code> 指定所有权</strong></p> <div class="language- extra-class"><pre class="language-text"><code>chown -R root:root /var/lib/jenkins
chown -R root:root /var/cache/jenkins
chown -R root:root /var/log/jenkins
</code></pre></div><p><strong>启动 <code>jenkins</code></strong></p> <div class="language- extra-class"><pre class="language-text"><code>service jenkins restart
</code></pre></div><p>看到 ok 即可</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e9781cdc4d0d20?w=1022&amp;h=116&amp;f=png&amp;s=56478" alt=""></p> <p><strong>访问<code>jenkins</code></strong></p> <div class="language- extra-class"><pre class="language-text"><code>ip地址 + 8080
</code></pre></div><p>首次访问是这样子的(官网图).</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e9785b24b1c66d?w=990&amp;h=679&amp;f=jpeg&amp;s=80191" alt=""></p> <p>这张图红色圈起来的替换成你页面显示的</p> <div class="language- extra-class"><pre class="language-text"><code>cat /val/jenkins_home/xxxx/xxx
</code></pre></div><p>然后将显示的复制到 输入框后，点击下一步即可。</p> <p><strong>然后到安装插件页面</strong></p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e9788ee23d7956?w=992&amp;h=562&amp;f=webp&amp;s=18674" alt="">
我这里是点击的 安装推荐插件 选项。</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e978ab3e4fa7fb?w=1049&amp;h=711&amp;f=webp&amp;s=15688" alt="">
等待即可，有点漫长 loading...
<br></p> <p><strong>创建用户</strong></p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e978ce5d84f03b?w=997&amp;h=440&amp;f=webp&amp;s=8020" alt=""> <strong>然后到这里 jenkins 就安装完毕了，点击开始使用。</strong> <img src="https://user-gold-cdn.xitu.io/2019/11/23/16e978d39e1efa02?w=1002&amp;h=287&amp;f=webp&amp;s=6772" alt=""> <br></p> <h3 id="新建任务"><a href="#新建任务" class="header-anchor">#</a> 新建任务</h3> <p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e97a483911d4c4?w=2892&amp;h=1716&amp;f=png&amp;s=468248" alt=""></p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e97a72f3a5eceb?w=2380&amp;h=1740&amp;f=png&amp;s=297530" alt="">
构建触发器，就是监听 <code>github</code> 的 <code>webhook</code>，如有新的 <code>push</code> 后 重新构建。
<img src="https://user-gold-cdn.xitu.io/2019/11/23/16e97f13c9584b74?w=2218&amp;h=1274&amp;f=png&amp;s=224857" alt=""> <img src="https://user-gold-cdn.xitu.io/2019/11/23/16e97a8ef003bf27?w=2480&amp;h=1676&amp;f=png&amp;s=233063" alt="">
此时保存即可</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e97ab1c9f352c8?w=1462&amp;h=1328&amp;f=png&amp;s=273397" alt="">
点击那个 w 列的🌞(太阳)，这里是构建的描述，
如果构建失败的话，你可以根据这里的提示定位问题。</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e97ae9d2cc2f2f?w=2218&amp;h=1166&amp;f=png&amp;s=447670" alt="">
这里我当时蒙蔽了一下，我就在想构建后的文件去哪里了，我该怎么访问?</p> <p><strong>构建后的存放地址</strong></p> <div class="language- extra-class"><pre class="language-text"><code>cd /var/lib/jenkins/workspace
</code></pre></div><p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e97c2d25d7766e?w=666&amp;h=198&amp;f=png&amp;s=74372" alt=""> <strong>此时我们在去修改一下配置信息中的 <code>shell</code></strong></p> <div class="language- extra-class"><pre class="language-text"><code>node -v
npm -v
npm install
npm run build
</code></pre></div><p>发现构建失败??</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e97c80f626adc0?w=2060&amp;h=1128&amp;f=png&amp;s=412669" alt="">
不过没关系</p> <p>我们进入全局设置的插件管理</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e97d00ff0d17fe?w=2416&amp;h=664&amp;f=png&amp;s=138227" alt="">
下载完后，我们去全局配置管理，发现对了 一个 NodeJs 选项。</p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e97dba6c7d3eea?w=2456&amp;h=1556&amp;f=png&amp;s=613978" alt=""></p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e97df209f5c541?w=1890&amp;h=1514&amp;f=png&amp;s=252702" alt="">
啊 千辛万苦，终于看到 我们最爱的 <code>dist</code> 文件了，这里你的 shell 命令可以自动拓展，如移动到其他位置。
<img src="https://user-gold-cdn.xitu.io/2019/11/23/16e97e71a410c751?w=2360&amp;h=1092&amp;f=png&amp;s=353467" alt=""></p> <h3 id="nginx"><a href="#nginx" class="header-anchor">#</a> nginx</h3> <div class="language- extra-class"><pre class="language-text"><code>cd /etc/nginx/conf.d
vim test-jenkins.conf

server {
      listen 8000; # 监听端口
      server_name _;
      location / {
        # 这里我这里指向 jenkins 构建的目录，也可以在构建时的 shell 将文件移动要其他地方。
        root  /var/lib/jenkins/workspace/test-jenkins/dist;
        try_files $uri $uri/ index.html;
      }

      error_page 500 502 503 504 /50x.html;
      location = /50x.html {
        root /usr/share/nginx/html;
      }
}
</code></pre></div><p><strong>然后打开就 ip:8000 就能访问了。</strong></p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e9804b2bf8f65f?w=2890&amp;h=778&amp;f=png&amp;s=121151" alt=""></p> <h3 id="last"><a href="#last" class="header-anchor">#</a> <strong>last</strong></h3> <p>我们在本地 重新 <code>push</code> ，看下这个页面会不会变。</p> <p>我们刷新页面如果发现 <code>404 Not Found</code> 不要方，<code>npm run build</code> 会先删除 <code>dist</code> 文件。</p> <p><strong>访问如下就说明我们基本配置全部完成了，</strong></p> <p><img src="https://user-gold-cdn.xitu.io/2019/11/23/16e980b30c15e52b?w=1972&amp;h=426&amp;f=png&amp;s=83982" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/blog/feat/pages/node.html">node</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.7e52a773.js" defer></script><script src="/blog/assets/js/2.49ba155e.js" defer></script><script src="/blog/assets/js/10.6f95f390.js" defer></script>
  </body>
</html>
