
> ## Jenkins

### **æ¦‚å¿µ**
- Jenkinsæ˜¯ä¸€æ¬¾å¼€æº CI&CD è½¯ä»¶ï¼Œç”¨äºè‡ªåŠ¨åŒ–å„ç§ä»»åŠ¡ï¼ŒåŒ…æ‹¬æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²è½¯ä»¶ã€‚

- Jenkins æ”¯æŒå„ç§è¿è¡Œæ–¹å¼ï¼Œå¯é€šè¿‡ç³»ç»ŸåŒ…ã€Docker æˆ–è€…é€šè¿‡ä¸€ä¸ªç‹¬ç«‹çš„ Java ç¨‹åºã€‚

### **ä¸ºä»€ä¹ˆè¦å­¦**
- å…¬å¸åœ¨ç”¨
- ç¨å¾®å¥½ä¸€ç‚¹çš„å²—ä½èŒè´£åƒ```jenkins```ä¹‹ç±» (æŒç»­é›†æˆã€è‡ªåŠ¨éƒ¨ç½²) çš„ï¼ŒåŸºæœ¬éƒ½æ˜¯å¤šå¤šå°‘å°‘æ˜¯ä¼šæåˆ°çš„ã€‚
- ä¼ ç»Ÿçš„åšæ³•ï¼Œåœ¨æœåŠ¡å™¨åˆå§‹ä¸€ä¸ª ```git``` ä»“åº“ï¼Œç„¶åæ¯æ¬¡ä»£ç æ›´æ–°åï¼Œäººå·¥æ‰‹åŠ¨å»æ‹‰å»ï¼Œæ¬¡æ•°å¤šäº†ä¹Ÿå°±çƒ¦äº†ï¼Œè€Œè¿™äº›æ¯æ¬¡åªéœ€åœ¨é¡¹ç›®å¼€å§‹å‰é…ç½®ä¸€é ```jenkins``` ä¹‹åæ‰€æœ‰çš„äººå·¥æ“ä½œéƒ½ä¸éœ€è¦ç®¡äº†ã€‚(ps: æœ‰é—®é¢˜ç”©é”…ç»™ ```jenkins``` å°±è¡Œäº†[å‘²ç‰™])

 ### **å‰ç½®ä»»åŠ¡**
- ```centOs``` æœåŠ¡å™¨
- ```git```ã€ ```linux```ã€```shell``` åŸºç¡€å°±è¡Œã€‚
- ```nginx```åŸºæœ¬é…ç½®ã€‚

### **å¼€ç¯‡å‡†å¤‡**
 **åˆå§‹ä¸€ä¸ª ```vuecli``` é¡¹ç›®ï¼Œè®¿é—®å¦‚ä¸‹**

![](https://user-gold-cdn.xitu.io/2019/11/23/16e97572df9eaafb?w=3318&h=1108&f=png&s=156601)
**åœ¨ ```github``` åˆ›å»ºä»“åº“**

![](https://user-gold-cdn.xitu.io/2019/11/23/16e975c831902e62?w=2488&h=1560&f=png&s=447256)

**é…ç½® ```github webhook```**

```http://ip:8080/github-webhook/```

![](https://user-gold-cdn.xitu.io/2019/11/23/16e97f623c208cc2?w=2264&h=1600&f=png&s=353667)


>## **ç›®å½•**
- [jenkins ç¯å¢ƒæ­å»º](#ç¯å¢ƒæ­å»º)
- [æ–°å»º jenkins ä»»åŠ¡](#æ–°å»ºä»»åŠ¡)
- [nginxè®¿é—®](#nginx)

### ç¯å¢ƒæ­å»º

ç™»å½•æœåŠ¡å™¨

**å®‰è£…```java```ä¾èµ–**
```
yum install java
```

**ä½¿ç”¨ ```wget``` æ·»åŠ ```jenkinsæº```**
```
wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins-ci.org/redhat/jenkins.repo
rpm --import https://jenkins-ci.org/redhat/jenkins-ci.org.key
```
**å®‰è£…ä¹‹åä½¿ç”¨ ```yum``` å‘½ä»¤å°±èƒ½ä¸‹è½½äº†ã€‚**
```js
yum install jenkins
```
**jenkins ä¿®æ”¹æƒé™ ç«¯å£ä¹‹ç±»çš„ï¼Œåœ¨è¯¥ä½ç½®**
```
vim /etc/sysconfig/jenkins
```
- JENKINS_PORT -> jenkinsçš„**å¯åŠ¨ç«¯å£**ï¼Œé»˜è®¤```8080```
- JENKINS_USER -> jenkins ç”¨æˆ·ï¼Œä¿®æ”¹ä¸º```root```
```
// è¿™é‡Œæˆ‘å°† JENKINS_USER ä¿®æ”¹ä¸º root ç”¨æˆ·äº†ã€‚
JENKINS_USER="root"
```
![](https://user-gold-cdn.xitu.io/2019/11/23/16e977fff4cdd93a?w=932&h=262&f=png&s=128287)

**ä½¿ç”¨ ```chown```ç»™ ```jenkins``` æŒ‡å®šæ‰€æœ‰æƒ**
```
chown -R root:root /var/lib/jenkins
chown -R root:root /var/cache/jenkins
chown -R root:root /var/log/jenkins
```

**å¯åŠ¨ ```jenkins```**
```
service jenkins restart
```
çœ‹åˆ° ok å³å¯

![](https://user-gold-cdn.xitu.io/2019/11/23/16e9781cdc4d0d20?w=1022&h=116&f=png&s=56478)


**è®¿é—®```jenkins```**
```
ipåœ°å€ + 8080
```
é¦–æ¬¡è®¿é—®æ˜¯è¿™æ ·å­çš„(å®˜ç½‘å›¾).


![](https://user-gold-cdn.xitu.io/2019/11/23/16e9785b24b1c66d?w=990&h=679&f=jpeg&s=80191)

è¿™å¼ å›¾çº¢è‰²åœˆèµ·æ¥çš„æ›¿æ¢æˆä½ é¡µé¢æ˜¾ç¤ºçš„
```
cat /val/jenkins_home/xxxx/xxx
```
ç„¶åå°†æ˜¾ç¤ºçš„å¤åˆ¶åˆ° è¾“å…¥æ¡†åï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥å³å¯ã€‚

**ç„¶ååˆ°å®‰è£…æ’ä»¶é¡µé¢**

![](https://user-gold-cdn.xitu.io/2019/11/23/16e9788ee23d7956?w=992&h=562&f=webp&s=18674)
æˆ‘è¿™é‡Œæ˜¯ç‚¹å‡»çš„ å®‰è£…æ¨èæ’ä»¶ é€‰é¡¹ã€‚


![](https://user-gold-cdn.xitu.io/2019/11/23/16e978ab3e4fa7fb?w=1049&h=711&f=webp&s=15688)
ç­‰å¾…å³å¯ï¼Œæœ‰ç‚¹æ¼«é•¿ loading...
<br/>

**åˆ›å»ºç”¨æˆ·**

![](https://user-gold-cdn.xitu.io/2019/11/23/16e978ce5d84f03b?w=997&h=440&f=webp&s=8020)
**ç„¶ååˆ°è¿™é‡Œ jenkins å°±å®‰è£…å®Œæ¯•äº†ï¼Œç‚¹å‡»å¼€å§‹ä½¿ç”¨ã€‚**
![](https://user-gold-cdn.xitu.io/2019/11/23/16e978d39e1efa02?w=1002&h=287&f=webp&s=6772)
<br/>

### æ–°å»ºä»»åŠ¡

![](https://user-gold-cdn.xitu.io/2019/11/23/16e97a483911d4c4?w=2892&h=1716&f=png&s=468248)

![](https://user-gold-cdn.xitu.io/2019/11/23/16e97a72f3a5eceb?w=2380&h=1740&f=png&s=297530)
æ„å»ºè§¦å‘å™¨ï¼Œå°±æ˜¯ç›‘å¬ ```github``` çš„ ```webhook```ï¼Œå¦‚æœ‰æ–°çš„ ```push``` å é‡æ–°æ„å»ºã€‚
![](https://user-gold-cdn.xitu.io/2019/11/23/16e97f13c9584b74?w=2218&h=1274&f=png&s=224857)
![](https://user-gold-cdn.xitu.io/2019/11/23/16e97a8ef003bf27?w=2480&h=1676&f=png&s=233063)
æ­¤æ—¶ä¿å­˜å³å¯


![](https://user-gold-cdn.xitu.io/2019/11/23/16e97ab1c9f352c8?w=1462&h=1328&f=png&s=273397)
ç‚¹å‡»é‚£ä¸ª w åˆ—çš„ğŸŒ(å¤ªé˜³)ï¼Œè¿™é‡Œæ˜¯æ„å»ºçš„æè¿°ï¼Œ
å¦‚æœæ„å»ºå¤±è´¥çš„è¯ï¼Œä½ å¯ä»¥æ ¹æ®è¿™é‡Œçš„æç¤ºå®šä½é—®é¢˜ã€‚

![](https://user-gold-cdn.xitu.io/2019/11/23/16e97ae9d2cc2f2f?w=2218&h=1166&f=png&s=447670)
è¿™é‡Œæˆ‘å½“æ—¶è’™è”½äº†ä¸€ä¸‹ï¼Œæˆ‘å°±åœ¨æƒ³æ„å»ºåçš„æ–‡ä»¶å»å“ªé‡Œäº†ï¼Œæˆ‘è¯¥æ€ä¹ˆè®¿é—®?

**æ„å»ºåçš„å­˜æ”¾åœ°å€**
```
cd /var/lib/jenkins/workspace
```

![](https://user-gold-cdn.xitu.io/2019/11/23/16e97c2d25d7766e?w=666&h=198&f=png&s=74372)
**æ­¤æ—¶æˆ‘ä»¬åœ¨å»ä¿®æ”¹ä¸€ä¸‹é…ç½®ä¿¡æ¯ä¸­çš„ ```shell```**
```
node -v
npm -v
npm install
npm run build
```
å‘ç°æ„å»ºå¤±è´¥??

![](https://user-gold-cdn.xitu.io/2019/11/23/16e97c80f626adc0?w=2060&h=1128&f=png&s=412669)
ä¸è¿‡æ²¡å…³ç³»

æˆ‘ä»¬è¿›å…¥å…¨å±€è®¾ç½®çš„æ’ä»¶ç®¡ç†

![](https://user-gold-cdn.xitu.io/2019/11/23/16e97d00ff0d17fe?w=2416&h=664&f=png&s=138227)
ä¸‹è½½å®Œåï¼Œæˆ‘ä»¬å»å…¨å±€é…ç½®ç®¡ç†ï¼Œå‘ç°å¯¹äº† ä¸€ä¸ª NodeJs é€‰é¡¹ã€‚

![](https://user-gold-cdn.xitu.io/2019/11/23/16e97dba6c7d3eea?w=2456&h=1556&f=png&s=613978)


![](https://user-gold-cdn.xitu.io/2019/11/23/16e97df209f5c541?w=1890&h=1514&f=png&s=252702)
å•Š åƒè¾›ä¸‡è‹¦ï¼Œç»ˆäºçœ‹åˆ° æˆ‘ä»¬æœ€çˆ±çš„ ```dist``` æ–‡ä»¶äº†ï¼Œè¿™é‡Œä½ çš„ shell å‘½ä»¤å¯ä»¥è‡ªåŠ¨æ‹“å±•ï¼Œå¦‚ç§»åŠ¨åˆ°å…¶ä»–ä½ç½®ã€‚
![](https://user-gold-cdn.xitu.io/2019/11/23/16e97e71a410c751?w=2360&h=1092&f=png&s=353467)

### nginx

```
cd /etc/nginx/conf.d
vim test-jenkins.conf

server {
      listen 8000; # ç›‘å¬ç«¯å£
      server_name _;
      location / {
        # è¿™é‡Œæˆ‘è¿™é‡ŒæŒ‡å‘ jenkins æ„å»ºçš„ç›®å½•ï¼Œä¹Ÿå¯ä»¥åœ¨æ„å»ºæ—¶çš„ shell å°†æ–‡ä»¶ç§»åŠ¨è¦å…¶ä»–åœ°æ–¹ã€‚
        root  /var/lib/jenkins/workspace/test-jenkins/dist;
        try_files $uri $uri/ index.html;
      }

      error_page 500 502 503 504 /50x.html;
      location = /50x.html {
        root /usr/share/nginx/html;
      }
}
```
**ç„¶åæ‰“å¼€å°± ip:8000 å°±èƒ½è®¿é—®äº†ã€‚

![](https://user-gold-cdn.xitu.io/2019/11/23/16e9804b2bf8f65f?w=2890&h=778&f=png&s=121151)


### **last**

æˆ‘ä»¬åœ¨æœ¬åœ° é‡æ–° ```push``` ï¼Œçœ‹ä¸‹è¿™ä¸ªé¡µé¢ä¼šä¸ä¼šå˜ã€‚

æˆ‘ä»¬åˆ·æ–°é¡µé¢å¦‚æœå‘ç° ```404 Not Found``` ä¸è¦æ–¹ï¼Œ```npm run build``` ä¼šå…ˆåˆ é™¤ ```dist``` æ–‡ä»¶ã€‚

**è®¿é—®å¦‚ä¸‹å°±è¯´æ˜æˆ‘ä»¬åŸºæœ¬é…ç½®å…¨éƒ¨å®Œæˆäº†ï¼Œ**

![](https://user-gold-cdn.xitu.io/2019/11/23/16e980b30c15e52b?w=1972&h=426&f=png&s=83982)



